<link rel="import" href="../../polymer/polymer-element.html">

<link rel="import" href="../curium-animation-manager-mixin.html">

<script>
  /**
    * `curium-slideshow-animation-manager`
    * Scene like animation
    *
    * @customElement
    * @polymer
    */
  class CuriumSlideshowAnimationManager extends Curium.CuriumAnimationManagerMixin(Polymer.Element) {

    static get is() { return 'curium-slideshow-animation-manager'; }
    
    static get properties() {
      return {
        duration: {
          type: Number,
          value: 1000
        },
        easing: {
          type: String,
          value: 'ease-out'
        }
      };
    }

    beforeAnimation(pageContainer, pageList, selectedPage, deselectedPage) {

      let keyframeEffectList = [];
      
      if (selectedPage) {
        this._setAnimating(pageContainer, selectedPage);
        selectedPage.style.zIndex = 2;
        keyframeEffectList.push(new KeyframeEffect(selectedPage, [
          { opacity: 0 },
          { opacity: 1 }
        ], this._getTiming({
          duration: this.duration,
          easing: this.easing
        })));
      }
      if (deselectedPage) {
        this._setAnimating(pageContainer, deselectedPage);
        deselectedPage.style.zIndex = 1;
        // keyframeEffectList.push(new KeyframeEffect(deselectedPage, [
        //   { opacity: 1 },
        //   { opacity: 0 }
        // ], this._getTiming({
        //   duration: this.duration,
        //   easing: this.easing
        // })));
      }

      let effect;
      switch (keyframeEffectList.length) {
        case 1: effect = keyframeEffectList[0]; break;
        case 2: effect = new GroupEffect(keyframeEffectList); break;
        default: effect = null;
      }

      return effect ? new Animation(effect, document.timeline) : null;
    }

    afterAnimation(pageContainer, pageList, selectedPage, deselectedPage) {
      for (let i = 0, page; page = pageList[i]; ++i) {
        this._unsetAnimating(pageContainer, page);
        page.style.zIndex = page === selectedPage ? 1 : 0;
      }
    }

  }

  window.customElements.define(CuriumSlideshowAnimationManager.is, CuriumSlideshowAnimationManager);
  window.Curium = window.Curium || {};
  Curium.CuriumSlideshowAnimationManager = CuriumSlideshowAnimationManager;
</script>
